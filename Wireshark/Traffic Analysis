WIRESHARK: Traffic Analysis
Activity description: Investigate and correlate the packet-level information to see the big picture in the network traffic, like detecting anomalies and malicious activities.
Tools used: VM, Wireshark, Nmap, CyberChef
Methodology:
1.	Nmap Scans - Identifying the most common Nmap scans: TCP connect scans, SYN scans and UDP scans.
-	To find the total number of TCP Connect scans:
  It means that it is the amount of bytes of data the host can send before the receiver will send an acknowledgement. If the host receives an acknowledgement, the window size will increase. If the host does not receive an acknowledgement from the receiver, the window size will decrease.
-	To find how many UDP close port messages there are:
 
Type 3 means that the destination is unreachable while code 3 means the port is unreachable.
-	To find which UDP port is open in the 55-70 range:
 
2.	ARP Poisoning & Man in The Middle - ARP protocol is the technology responsible for allowing devices to identify themselves on a network. Address Resolution Protocol Poisoning (also known as ARP Spoofing or Man In The Middle (MITM) attack) is a type of attack that involves network jamming/manipulating by sending malicious ARP packets to the default gateway. The ultimate aim is to manipulate the IP to MAC address table and sniff the traffic of the target host.
-	To detect the number of ARP requests crafted by a fictitious attacker with MACa address 00:0c:29:e2:18:b4. “00:00:00:00:00:00” would be the target MAC address as the requests are made to the switch in order to find who owns which IP address.
 
-	To find the number of HTTP packets received by the attacker I filtered by the MAC address destination and the protocol type:
 
-	To find the number of sniffed username&password entries I initially filtered by POST requests. Checking out their contents, I spotted some “uname” and “pass” values, so I applied the “pass” filter.
 
3.	Identifying Hosts: DHCP, NetBIOS and Kerberos - When investigating a compromise or malware infection activity, it is important to know how to identify the hosts on the network apart from IP to MAC address match. One of the best methods is identifying the hosts and users on the network to decide the investigation's starting point and list the hosts and users associated with the malicious traffic/activity.
-	To find the MAC address of the host “Galaxy A30” I filtered by the pattern “Galaxy” and found the data of interest in the DHCP section option 61:
 
 
-	To find how many NetBIOS registration requests the "LIVALJM" workstation has, I initially filtered by all the nbns queries that contained the keyword of interest and noticed in the NetBIOS Name Service details that the operation code for registration requests is 5, so I added it to the filter and obtained the desidered result.
 
-	To find the host who requested the IP address 172.16.13.85 I filtered by the packet that contained that information and found the desidered name in option 12 of the packet’s details
 
 
-	To find the IP address of the user “u5” I applied the filter “kerberos.CNameString contains “u5”. Then, I know that kerberos is port 88, and I saw that address 10.1.12.2 sent some request packets and must be “u5” user.
 
Since the exercise was asking for the defanged format, I used CyberChef.
 
4.	Tunnelling Traffic: ICMP and DNS - Tunnelling provides anonymity and traffic security. Therefore it is highly used by enterprise networks. However, as it gives a significant level of data encryption, attackers use tunnelling to bypass security perimeters using the standard and trusted protocols used in everyday traffic like ICMP and DNS.
Internet Control Message Protocol (ICMP) is designed for diagnosing and reporting network communication issues.
Domain Name System (DNS) is designed to translate/convert IP domain addresses to IP addresses.

-	To investigate the protocol used in ICMP tunneling, I initially filtered by ICMP, but the result does not give enough data to analyse. So, I modified the query to include the protocols commonly used for data exfiltration such as SSH, FTP, TCP, and HTTP and got 3 results. By analysing the packets, the string on the right side are commonly associated with SSH protocol negotiation, encryption algorithms, and authentication methods.
 
 
-	To find the suspicious name address that receives anomalous DNS queries I filtered by the query name length to be longer than 40 to look for DNS names with particularly long lengths, which is highly suspicious for a normal DNS name. !mdns disable local link device queries. I investigated the results that I got and spotted dataexfil.com as the suspicious domain address requested.
 
 
5.	Cleartext Protocol Analysis: FTP - File Transfer Protocol (FTP) is designed to transfer files with ease, so it focuses on simplicity rather than security.
-	To investigate how many incorrect attempts there are, I applied the following filter, knowing that 530 is the code relative to failed login, invalid password:
 
-	The see the size of the file accessed by the “ftp” account I filtered by code 213. The ftp.response.code of 213 provides information about the status or size of a downloaded file. The “arg” value contains the readable strings that include file size in bytes.
 
-	To find the file name that an adversary downloaded from the server, I filtered by the command “RETR”. The FTP command “RETR” is used to retrieve (or download) files or documents from the FTP server to our local system.
 
-	To find the command with which the adversary tried to assign special flags to change the executing permissions of the downloaded file, I filtered by “CHMOD”, which is a terminal command used for modifying file permissions using numeric or symbolic representation.
 
6.	Cleartext Protocol Analysis: HTTP - Hypertext Transfer Protocol (HTTP) is a cleartext-based, request-response and client-server protocol. It is the standard type of network activity to request/serve web pages, and by default, it is not blocked by any network perimeter.
-	To find the anomalous “useragent” types, I initially filtered by http.user_agent, filtered the list with it as a column and spotted a few lines using Windows NT 6.4, which is suspicious.
 
-	To locate yìthe “Log4j” attack starting phase I applied the following filter. 
 
-	To locate the "Log4j" attack starting phase and decode the base64 command and find the IP address was contacted by the adversary, I copied the value of the User-Agent and then decoded it from base 64 using cyberchef.
 
7.	Encrypted Protocol Analysis: Decrypting HTTPS - HTTPS uses TLS protocol to encrypt communications, so it is impossible to decrypt the traffic and view the transferred data without having the encryption/decryption key pairs. As this protocol provides a good level of security for transmitting sensitive data, attackers and malicious websites also use HTTPS.
-	To find the frame number of the “Client Hello” message sent to “accounts.google.com” I filtered by the “Client Hello” packets excluding SSDP, which is a network protocol that provides advertisement and discovery of network services. Then, investigating in the protocol details panel, I found eventually the desired packet.
 
-	To decrypt the traffic, I uploaded the key-log file in the “Edit → Preferences → Protocols → TLS” menu. Then, to find the number of HTTP2 packets I applied a general filter for that value.
 
Lessons Learned: This exercise demonstrated that comprehensive network visibility is critical for detecting malicious activities such as Nmap reconnaissance, ARP poisoning, and MITM attacks. I learned that analyzing packet-level details—such as identifying anomalies in ICMP/DNS tunneling, decoding Base64 payloads in Log4j attacks, and decrypting TLS traffic using key-log files—is essential for uncovering hidden threats and data exfiltration within a network.


